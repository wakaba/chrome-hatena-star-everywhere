<!DOCTYPE HTML>
<html lang=en>
<title>Options &mdash; Hatena Star Everywhere</title>
<style>
  body {
    margin: 0;
    padding: 0.5em;
  }

  p {
    margin: 0;
    padding: 0;
    line-height: 1.4;
  }
  
  h1 {
    margin: 0;
    padding: 0 0 0.4em 66px;
    background-image: url(star.gif);
    background-repeat: no-repeat;
    background-position: center left;
    min-height: 66px;
    font-size: 150%;
    line-height: 66px;
  }
  
  section {
    margin: 0;
    margin-bottom: 1em;
  }
  
  body > section > hgroup {
    border-top: 1px solid #B5C7DE;
    background-color: #F4F6FC;
    border-color: 1px solid #EDEFF5;
  }
  
  h2 {
    margin: 0;
    padding: 0.4em 0.5em;
    font-size: 100%;
    background-color: #EBEFF9;
  }
  
  section > hgroup > p {
    margin: 0;
    padding: 0.3em 0.5em;
    font-size: 90%;
  }

  section > section {
    display: -webkit-box;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    border-bottom: 1px solid #CDCDCD;
    padding-bottom: 0.2em;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }
  section > section > hgroup {
    width: 10em;
  }
  section > section > hgroup p {
    font-size: 80%;
  }
  section > section p {
    -webkit-box-flex: 1;
  }
  section > section div {
    margin-bottom: 0.5em;
  }
  h3 {
    display: block;
    margin: 0;
    padding: 0;
    font-size: 100%;
  }
  textarea {
    width: 100%;
    height: 5em;
  }
  
  menu, ul {
    margin: 0.5em 0.5em;
    padding: 0;
  }
  menu li, ul li {
    margin: 0;
    padding: 0.5em;
  }
  
  .actions li {
    display: block;
    padding: 0;
    line-height: 1.4;
  }
  
  .actions li::before {
    content: "\261E" " ";
  }
  
  .choices li {
    display: block;
    padding: 0;
    line-height: 1.5;
  }
  
  .profile-image-link {
    margin-right: 0.3em;
  }
  .nickname-link {

  }
</style>
<body>

<h1>Options &mdash; Hatena Star Everywhere</h1>

<section id=account>
  <hgroup>
    <h2>Hatena ID</h2>
  </hgroup>

  <section>
    <hgroup>
      <h3>Hatena ID</h3>
    </hgroup>
    <div hidden id=account-for-user>
      <p class=user-info>
      <menu class=actions>
        <li><a id=logout-link onclick="
          return confirm(this.getAttribute ('data-confirm'));
        " data-confirm="Do you really want to logout?">Logout</a>
      </menu>
    </div>
    <div id=account-for-guest>
      <p>You are not currently logged in.
      <menu class=actions>
        <li><a id=login-link>Login</a>
        <li><a id=register-link>Create an account</a>
      </menu>
    </div>
  </section>
  <section>
    <hgroup>
      <h3>Community</h3>
    </hgroup>
    <div>
      <p>Choose your preferrable community:
      <ul class=choices>
        <li><label><input type=radio name=tld value=jp id=community-jp> Japan (hatena.ne.jp)</label>
        <li><label><input type=radio name=tld value=com id=community-com> Worldwide (hatena.com)</label>
      </ul>
    </div>
  </section>
</section>

<section id=privacy>
  <hgroup>
    <h2>Privacy</h2>
    
    <p>You can specify patterns for disallowed and allowed URLs.  URLs disallowed by these patterns, as well as URLs in a Secret Window, will not be sent to Hatena Star server automatically.  You can still show list of stars for these URLs by opening the star panel by clicking the Star icon.  Note that these regular expressions are evaluated in order.
  </hgroup>
  
  <section>
    <hgroup>
      <h3>1. Allowed URLs</h3>
    </hgroup>
    <p><textarea disabled>^http://&#xa;^https://</textarea>
  </section>
  
  <section>
    <hgroup>
      <h3>2. Disallowed URLs</h3>
      <p>(Newline-separated regular expressions)
    </hgroup>
    <p><textarea id=disallowedURLs></textarea>
  </section>
  
  <section>
    <hgroup>
      <h3>3. Allowed URLs</h3>
      <p>(Newline-separated regular expressions)
    </hgroup>
    <p><textarea id=allowedURLs></textarea>
  </section>
  
  <p><button type=button onclick="
    if (confirm(this.getAttribute ('data-confirm'))) {
      config.delete ('allowedURLs');
      config.delete ('disallowedURLs');
      location.reload ();
    }
  " data-confirm="Do you really want to revert all your changes?">Use default</button>
</section>

<section id=devel>
  <hgroup>
    <h2>For development</h2>
  </hgroup>

  <menu>
    <li><a href="logs.html">Logs</a>
  </menu>
</section>

<script>
  var bg = chrome.extension.getBackgroundPage ();
  var config = bg.config;

  var ids = ['disallowedURLs', 'allowedURLs'];
  ids.forEach (function (id) {
    var el = document.getElementById (id);
    el.value = config.get (id);
    el.onchange = function () {
      config.set (id, el.value);
    }; // onchange
  });
  
  var accountForUser = document.getElementById ('account-for-user');
  var accountForGuest = document.getElementById ('account-for-guest');
  function updateAccountInfo () {
    var tld = config.get ('tld');
    document.getElementById ('community-' + tld).checked = true;
    bg.getCurrentUser (function (user) {
      if (user.urlName) {
        accountForUser.hidden = false;
        accountForGuest.hidden = true;
        user.fillHTML (accountForUser.getElementsByClassName ('user-info')[0]);
        document.getElementById ('logout-link').href = 'http://' + config.getDomain ('www') + '/logout?location=http://' + config.getDomain ('s') + '/';
      } else {
        accountForUser.hidden = true;
        accountForGuest.hidden = false;
        document.getElementById ('login-link').href = 'http://' + config.getDomain ('www') + '/login?location=http://' + config.getDomain ('s') + '/';
        document.getElementById ('register-link').href = 'http://' + config.getDomain ('www') + '/register?location=http://' + config.getDomain ('s') + '/';
      }
    }, {fromServer: true});
  } // updateAccountInfo
  
  document.getElementById ('community-jp').onchange = function () {
    config.set ('tld', 'jp');
    updateAccountInfo ();
  }; // onchange
  document.getElementById ('community-com').onchange = function () {
    config.set ('tld', 'com');
    updateAccountInfo ();
  }; // onchange
  
  updateAccountInfo ();
</script>

<!--
/* ***** BEGIN LICENSE BLOCK *****
 * Copyright 2011 Wakaba <w@suika.fam.cx>.  All rights reserved.
 *
 * This program is free software; you can redistribute it and/or 
 * modify it under the same terms as Perl itself.
 *
 * Alternatively, the contents of this file may be used 
 * under the following terms (the "MPL/GPL/LGPL"), 
 * in which case the provisions of the MPL/GPL/LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of the MPL/GPL/LGPL, and not to allow others to
 * use your version of this file under the terms of the Perl, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the MPL/GPL/LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the Perl or the MPL/GPL/LGPL.
 *
 * "MPL/GPL/LGPL":
 *
 * Version: MPL 1.1/GPL 2.0/LGPL 2.1
 *
 * The contents of this file are subject to the Mozilla Public License Version
 * 1.1 (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 * <http://www.mozilla.org/MPL/>
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * The Original Code is Hatena Star Everywhere code.
 *
 * The Initial Developer of the Original Code is Wakaba.
 * Portions created by the Initial Developer are Copyright (C) 2011
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 *   Wakaba <w@suika.fam.cx>
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 2 or later (the "GPL"), or
 * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the MPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the LGPL or the GPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the MPL, the GPL or the LGPL.
 *
 * ***** END LICENSE BLOCK ***** */
-->
